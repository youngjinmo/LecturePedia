# ğŸ“™LecturePedia

> SpringBootì™€ Spring Data JPAë¥¼ ì‚¬ìš©í•˜ì—¬ ì›¹ ê²Œì‹œíŒ êµ¬í˜„í•˜ê¸°

![](src/main/resources/static/assets/documents/main.png)

## <a name="toc"></a>ToC

1. [ê¸°ìˆ  ìŠ¤íƒ](#1)
3. [í•µì‹¬ ê¸°ëŠ¥](#2)
4. [íŠ¸ëŸ¬ë¸” ìŠˆíŒ…](#3)
5. [í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë°°ìš´  ê²ƒ](#4)

<br>

## [ğŸ”](#toc)<a name="1">1. ê¸°ìˆ  ìŠ¤íƒ</a>

<table>
  <tr>
    <th style="width: 20%;">Spring Boot</th>
    <td>ë³¸ í”„ë¡œì íŠ¸ëŠ” Spring Boot 2.4.5ë¡œ ê°œë°œí•˜ì˜€ìŠµë‹ˆë‹¤.</td>
  </tr>
  <tr>
    <th style="width: 20%;">Spring Data JPA</th>
    <td>JPAì—ì„œ ìë™ìƒì„±í•´ì£¼ëŠ” ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì‘ì„±í•˜ëŠ”ëŒ€ì‹  OOPì— ì§‘ì¤‘í•˜ë©° ê°œë°œí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. </td>
  </tr>
  <tr>
    <th style="width: 20%;">Spring Security</th>
    <td>íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ ê³¼ì •ì—ì„œ ì‚¬ìš©ìì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ í‰ë¬¸ëŒ€ì‹  Bcrypt í•´ì‹œí•¨ìˆ˜ë¡œ ì¸ì½”ë”©í•œ ê°’ì„ ì €ì¥í•˜ì˜€ìŠµë‹ˆë‹¤.</td>
  </tr>
  <tr>
    <th style="width: 20%;">Ajax</th>
    <td>íšŒì›ê°€ì… ê³¼ì •ì—ì„œ ì´ë©”ì¼ ì¤‘ë³µê²€ì‚¬ë¥¼, ë¡œê·¸ì¸ ê³¼ì •ì—ì„œ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ì„ Ajaxë¡œ ê²€ì¦í•˜ì˜€ìŠµë‹ˆë‹¤.</td>
  </tr>
  <tr>
    <th style="width: 20%;">Mustache</th>
    <td>í™”ë©´ì—ì„œ ë¡œì§ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í…œí”Œë¦¿ ì—”ì§„, Mustacheë¥¼ ì‚¬ìš©í•˜ì—¬ í™”ë©´ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.</td>
  </tr>
  <tr>
    <th style="width: 20%;">Lombok</th>
    <td>VO í•„ë“œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì‚­ì œí• ë•Œ Getter/Setterë¥¼ ì‘ì—…í•˜ëŠ” ëŒ€ì‹  Lombok ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì½”ë“œ ì‘ì„±ì„ ìµœì†Œí™”í•˜ì˜€ìŠµë‹ˆë‹¤.</td>
  </tr>
  <tr>
    <th style="width: 20%;">H2 Databse</th>
    <td>ë¡œì»¬ í™˜ê²½ì—ì„œ ê°œë°œí•  ë•Œ í¸ë¦¬í•œ ê°œë°œì„ ìœ„í•´ H2 ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°œë°œí–ˆìŠµë‹ˆë‹¤.</td>
  </tr>
  <tr>
    <th style="width: 20%;">MySQL</th>
    <td>ì˜ì†ì ì¸ ë°ì´í„° ì‚¬ìš©ì„ ìœ„í•´ MySQLì„ RDBMSë¡œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</td>
  </tr>
  <tr>
    <th style="width: 20%;">Docker</th>
    <td>MySQLì„ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ Dockerë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</td>
  </tr>
  <tr>
    <th style="width: 20%;">JUnit5</th>
    <td>ì„œë¹„ìŠ¤ ë¡œì§ ê²€ì¦ì„ ìœ„í•´ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</td>
  </tr>
</table>


<br>

## [ğŸ”](#toc)<a name="2">2. í•µì‹¬ ê¸°ëŠ¥</a>

- [ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”](#2-1)
- [admin ê¶Œí•œ ë¶€ì—¬ ë° ì‚¬ìš©ì ê´€ë¦¬](#2-2)

- [ì¡°íšŒìˆ˜ ê¸°ëŠ¥ ì¶”ê°€ (ì‘ì„±ì ë³¸ì¸ ë˜ëŠ” Adminì€ ì¡°íšŒìˆ˜ ì¹´ìš´íŒ…âœ–ï¸)](#2-3)
- [ë©”ì¸ í˜ì´ì§€ì—ì„œ ì¡°íšŒìˆ˜ ë†’ì€ 4ê°œì˜ ê²Œì‹œê¸€ ë…¸ì¶œ](#2-4)
- [ìµœê·¼ì‘ì„±ìˆœìœ¼ë¡œ ê²Œì‹œê¸€ ì •ë ¬ ë° í•œ í˜ì´ì§€ì— ê²Œì‹œê¸€ 5ê°œì”© ë…¸ì¶œë˜ë„ë¡ í˜ì´ì§• êµ¬í˜„](#2-5)

### [ğŸ”](#2) <a name="2-1">2-1. ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”</a>

![](src/main/resources/static/assets/documents/feature2-1.gif)

Spring Securityì— ë‚´ì¥ëœ Password ì¸í„°í˜ì´ìŠ¤ì˜ `encode()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ì•”í˜¸í™”í•œ ë¹„ë°€ë²ˆí˜¸ëŠ” ì„œë²„ì—ì„œ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ `equals()` ëŒ€ì‹  Password ì¸í„°í˜ì´ìŠ¤ì— ë‚´ì¥ëœ `matches()` ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìê°€ ì…ë ¥í•œ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ì™€ ì„œë²„ì— ì €ì¥ëœ ì¸ì½”ë”©ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¹„êµí•˜ì—¬ ë°˜í™˜ëœ boolean ê°’ì„ í†µí•´ ë¡œê·¸ì¸ì„ ê²€ì¦í•˜ì˜€ìŠµë‹ˆë‹¤. 

**userLogin.html**

~~~html
<button class="btn btn-success pull-right"
      style="margin-top: 1.5em;"
      onclick="validationLogin();"
      type="button">ë¡œê·¸ì¸</button>
~~~

Formì•ˆì— ë²„íŠ¼ì„ ìƒì„±í•´ì„œ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´, ìë°” ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‘ì„±ëœ ë¡œê·¸ì¸ ê²€ì¦ í•¨ìˆ˜(`function validationLogin()`)ê°€ ì‹¤í–‰ë˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ Form ì•ˆì— ë²„íŠ¼ì„ ìƒì„±í•˜ë©´ submitì´ ë˜ë¯€ë¡œ `type="button"` ì†ì„±ì„ ì¶”ê°€í•˜ì—¬ ìë™ìœ¼ë¡œ submitë˜ì§€ ì•Šê³  `validationLogin()` ì— ì˜í•´ submitë˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

~~~javascript
function validationLogin() {
   let email = document.getElementById('email').value;
   let password = document.getElementById('password').value;
   let loginForm = document.loginForm;

   let isOkEmail = validationEmail(email);
   if(isOkEmail) {
   let isOkPassword = validationPassword(email, password);
      if(isOkPassword) {
         alert("Welcome back!");
         loginForm.submit();
      } else { alert("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì˜ëª» ì…ë ¥í•˜ì˜€ìŠµë‹ˆë‹¤."); }
   } else { alert("ì´ë©”ì¼ì„ ì˜ëª» ì…ë ¥í•˜ì˜€ìŠµë‹ˆë‹¤."); }
}
~~~

ë¡œê·¸ì¸ ê²€ì¦ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ í™”ë©´ì—ì„œ ê°€ì ¸ì™€ì„œ ê°ê°ì„ ë‹¤ì‹œ ê²€ì¦í•˜ëŠ” Ajaxë¥¼ ì‹¤í–‰í•˜ì—¬ ë°˜í™˜ë˜ëŠ” ê²°ê³¼(`boolean`)ì— ë”°ë¼ ì–´ë–¤ ì˜ì—­ì—ì„œ ì˜ëª»ë˜ì—ˆëŠ”ì§€ë¥¼ í™”ë©´ì—ì„œ ì•Œë ¤ì£¼ê³ , ëª¨ë“  ê²€ì¦ì„ í†µê³¼í•˜ë©´ Formì´ submitë˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

ì‚¬ìš©ìì˜ ì´ë©”ì¼ì„ í†µí•´ Repositoryë¥¼ ì¡°íšŒí•˜ì—¬ ì¸ì½”ë”©ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì´ë©”ì¼ ê²€ì¦ì´ í†µê³¼í•˜ì§€ ëª»í•˜ë©´ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ í•¨ìˆ˜ê°€ errorë¥¼ ë°˜í™˜í•˜ê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë©”ì¼ ê²€ì¦ì—ì„œ trueë¥¼ ë°˜í™˜ë°›ì€ ê²½ìš°ì—ë§Œ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë„ë¡ Ajax í•¨ìˆ˜ë¥¼ ë™ê¸°ì (`async: false`)ìœ¼ë¡œ ìˆ˜í–‰í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

~~~javascript
function validationPassword(email, password) {
   let result = false;
   $.ajax({
      type: 'POST',
      url: '/user/passwordChk',
      async: false,
      dataType: 'json',
      data: {
         'email': email,
         'password': password
      },
      success: function(data) {
         if(data) {
            result = true;
         }
      },
      error: function(error){
         alert("ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ì˜¤ë¥˜ !!");
         alert(error);
      }
   });
   return result;
}
~~~

API ìš”ì²­ì˜ ê²°ê³¼ë¥¼ boolean íƒ€ì…ìœ¼ë¡œ ë°›ì•„ì„œ ë°˜í™˜ê°’ì— ë”°ë¼ ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤. 

**UserController.java**

~~~java
@RequestMapping(value = "/user/passwordChk", method = RequestMethod.POST)
public @ResponseBody boolean validationPasswordByLogin(@RequestParam String email, @RequestParam String password) {
   return userService.validationLoginByPassword(email, password);
}
~~~

`Model`ì„ ë°˜í™˜í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì•„ë‹Œ `boolean` íƒ€ì…ì˜ entityë¥¼ ë°˜í™˜í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì´ë¯€ë¡œ `@ResponseBody` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¹„êµí•˜ëŠ” ë©”ì†Œë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

**UserServiceImpl.java**

~~~java
@Override
public boolean validationLoginByPassword(String email, String password) {
   User targetUser = userRepository.findByEmail(email);
   return passwordEncoder.matches(password, targetUser.getPassword());
}
~~~

ì‹¤ì œë¡œ `passwordEncoder.matches()`ê°€ ì˜ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤.

![](src/main/resources/static/assets/documents/password-encoder-test.png)

<br>

### [ğŸ”](#2) <a name="2-2">2-2. admin ê¶Œí•œ ë¶€ì—¬ ë° ì‚¬ìš©ì ê´€ë¦¬</a>

![](src/main/resources/static/assets/documents/feature2-2.gif)

Enumìœ¼ë¡œ ìƒì„±ëœ  `Role`ì´ `Role.Admin`ì´ë©´ ë©”ì¸í˜ì´ì§€ì—ì„œ ì‚¬ìš©ì ëª©ë¡ í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, ì—¬ê¸°ì„œ ì‚¬ìš©ìë¥¼ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ Adminì€ ëª¨ë“  ê²Œì‹œê¸€ì— ëŒ€í•´ ì‚­ì œ ê¶Œí•œì„ ê°–ê³ ìˆìŠµë‹ˆë‹¤.  

**UserController.java**

~~~java
@GetMapping("/user/list")
public String userList(HttpSession session, Model model) {
   if(HttpSessionUtils.hasRoleLoginUser(session, Role.ADMIN)) {
      model.addAttribute("users",userService.getAllUsers());
      return "user/userList";
   }
   return "redirect:/";
}
~~~

**HttpSessionUtils.java**

~~~java
public static boolean isLoginUser(HttpSession session) {
   if(getUserFromSession(session)==null) {
      return false;
   }
   return true;
}

public static boolean hasRoleLoginUser(HttpSession session, Role role) {
   if(isLoginUser(session)) {
      Role roleOfCurrentUser = getUserFromSession(session).getRole();
      return roleOfCurrentUser.equals(role);
   }
   return false;
}
~~~

ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•´ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ API ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, ì„¸ì…˜ê´€ë ¨ ë©”ì†Œë“œë¥¼ ë¶„ë¦¬í•œ ì‹±ê¸€í†¤ ê°ì²´ `HttpSessionUtils`ì˜ ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ì—¬ í˜„ì¬ ì„¸ì…˜ì˜ ì‚¬ìš©ìê°€ `Role.ADMIN`ì˜ ê¶Œí•œì´ ìˆëŠ”ì§€ë¥¼ ê²€ì¦í•©ë‹ˆë‹¤. ê¶Œí•œì´ ìˆë‹¤ë©´ ì‚¬ìš©ì ëª©ë¡ í˜ì´ì§€ë¥¼ ë°˜í™˜í•´ì£¼ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë‹¤ì‹œ ë©”ì¸í˜ì´ì§€ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.

<br>

### [ğŸ”](#2) <a name="2-3">2-3. ì¡°íšŒìˆ˜ ê¸°ëŠ¥ ì¶”ê°€</a>

![](src/main/resources/static/assets/documents/feature2-3.gif)

ê²Œì‹œê¸€ì— ì ‘ê·¼í•˜ë©´ ì¡°íšŒìˆ˜ê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê²Œì‹œê¸€ ì‘ì„±ì ë³¸ì¸ ë˜ëŠ” Adminì´ë¼ë©´ ê²Œì‹œê¸€ ì¡°íšŒìˆ˜ëŠ” ì˜¬ë¼ê°€ì§€ ì•Šë„ë¡ ê²€ì¦ ë¡œì§ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.

~~~java
@GetMapping("/lecture/{lectureId}")
public String getLecture(@PathVariable Long lectureId, Model model, HttpSession session) {
   if(!HttpSessionUtils.isLoginUser(session)) {
      return "redirect:/login";
   }
   if(userService.hasAuthority(lectureId, session)) {
      model.addAttribute("authority", true);
   } else {
      lectureService.increaseViewCount(lectureId);
   }
   Lecture targetLecture = lectureService.getLecture(lectureId);
   model.addAttribute("lecture",targetLecture);
   return "lecture/detailLecture";
}
~~~

ê²Œì‹œê¸€ì— ì ‘ê·¼í•˜ëŠ” API ìš”ì²­ì´ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ë“¤ì–´ì˜¤ë©´, ìš°ì„  ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì¸ì§€ë¶€í„° ê²€ì¦í•˜ê³ , ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë¼ë©´ ê¶Œí•œì„ ê²€ì¦í•˜ì˜€ìŠµë‹ˆë‹¤. 

ë§Œì•½ ê²Œì‹œê¸€ ì‘ì„±ìê±°ë‚˜ Adminì´ë©´, ê²Œì‹œê¸€ì˜ ìˆ˜ì • ë˜ëŠ” ì‚­ì œ ë²„íŠ¼ì´ ë³´ì—¬ì§€ë„ë¡ `Model`ì— booleanê°’ì„ ë‹´ì•˜ìŠµë‹ˆë‹¤.

~~~html
{{#authority}}
<a href="/lecture/update/{{lecture.id}}">
  <button class="btn btn-success pull-right" style="float: left; margin-top: 1em; margin-left: 1em">ìˆ˜ì •í•˜ê¸°</button>
</a>
<button class="btn btn-danger pull-right"
        style="margin-top: 1em; margin-left: 1em"
        onclick="deleteLecture();">ì‚­ì œí•˜ê¸°</button>
{{/authority}}
~~~

ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•´ ë„˜ì–´ì˜¨ Model ê°ì²´ì¤‘ `"authority"` ì´ë¦„ì˜ ê°ì²´ê°€ ìˆë‹¤ë©´, ìˆ˜ì •/ì‚­ì œí•˜ê¸° ë²„íŠ¼ì„ ì¶œë ¥í•©ë‹ˆë‹¤.

ê²Œì‹œê¸€ ì‘ì„±ì ë˜ëŠ” Adminì´ ì•„ë‹ˆë¼ë©´ ì¡°íšŒìˆ˜ë¥¼ ì¦ê°€í•˜ëŠ” ì„œë¹„ìŠ¤ ë¡œì§ì„ í˜¸ì¶œí–ˆìŠµë‹ˆë‹¤.

~~~java
@Override
public void increaseViewCount(Long id) {
   Lecture targetLecture = getLecture(id);
   targetLecture.setViews(targetLecture.getViews()+1);
   lectureRepository.save(targetLecture);
}
~~~

<br>

### [ğŸ”](#2) <a name="2-4"> 2-4. ë©”ì¸ í˜ì´ì§€ì—ì„œ ì¡°íšŒìˆ˜ ë†’ì€ 4ê°œì˜ ê²Œì‹œê¸€ ë…¸ì¶œ

![ë©”ì¸í˜ì´ì§€ ì¡°íšŒìˆ˜ ë†’ì€ 4ê°œ ê²Œì‹œê¸€ ë…¸ì¶œ](src/main/resources/static/assets/documents/feature2-4.gif)

ì¡°íšŒìˆ˜ ë†’ì€ 4ê°œì˜ ê²Œì‹œê¸€ì„ ë©”ì¸ í˜ì´ì§€ì— ë…¸ì¶œì‹œí‚¤ëŠ” ë¡œì§ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ Repositoryì—ì„œ ì¡°íšŒìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ 4ê°œì˜ ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë©”ì†Œë“œë¥¼ ì„ ì–¸í–ˆìŠµë‹ˆë‹¤.

~~~java
@Repository
public interface LectureRepository extends JpaRepository<Lecture, Long> {
   List<Lecture> findTop4ByOrderByViewsDesc();
~~~

JpaRepositoryë¥¼ ìƒì†ë°›ëŠ” `LectureRepository`ì—ì„œ `findTop4ByOrderByViewsDesc()`ë¥¼ ì„ ì–¸í•˜ë©´ Hibernateì—ì„œ ìë™ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ëŠ”ë° ì´ ë•Œ ìƒì„±ë˜ëŠ” ì¿¼ë¦¬ëŠ” ì•„ë˜ì˜ ì¿¼ë¦¬ì™€ ê°™ìŠµë‹ˆë‹¤.

~~~sql
SELECT * FROM Lecture Order BY views DESC LIMIT 4;
~~~

Hibernateì—ì„œ ìƒì„±í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ì½˜ì†”ì— ì¶œë ¥ë˜ë„ë¡ application.propertiesì— ì„¤ì •ì„ ì¶”ê°€í•´ì„œ í™•ì¸í•œê²°ê³¼ ì•„ë˜ì˜ ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ëŠ”ê±¸ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.

~~~properties
spring.jpa.show-sql=true
~~~

![](src/main/resources/static/assets/documents/query-hibernate-created.png)

 <br>

### [ğŸ”](#2) <a name="2-5"> 2-5. ìµœê·¼ì‘ì„±ìˆœìœ¼ë¡œ ê²Œì‹œê¸€ ì •ë ¬ ë° í•œ í˜ì´ì§€ì— ê²Œì‹œê¸€ 5ê°œì”© ë…¸ì¶œë˜ë„ë¡ í˜ì´ì§• êµ¬í˜„

![á„‘á…¦á„‹á…µá„Œá…µá†¼](src/main/resources/static/assets/documents/feature2-5.gif)

í•œ í˜ì´ì§€ì— ê°•ì˜ 5ê°œë§Œ ë³´ì´ë„ë¡ í˜ì´ì§•ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.

Jpaì—ì„œëŠ” `Pageable`ì„ ì´ìš©í•´ì„œ ê°„ë‹¨í•˜ê²Œ í˜ì´ì§•ì„ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 

**LectureController.java**

~~~java
@GetMapping("/lecture/list")
public String retrievePosts(final @PageableDefault(size = 5, page = 0) Pageable pageable, Model model) {
   if(lectureService.isEmptyList()) {
      return "redirect:/lecture/register";
   }

   Page<Lecture> lecturesForPage = lectureService.getLecturesByPagination(pageable);
   List<Lecture> lectures = lecturesForPage.getContent();
   model.addAttribute("lectures", lectures);

   long totalCount = lectureService.getLecturesTotalCount();
   model.addAttribute("totalCount",totalCount);
   return "lecture/listLecture";
}
~~~

`@PageableDefault` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ í˜ì´ì§•ì˜ ë””í´íŠ¸ë¥¼ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤. `size`ëŠ” í•œ í˜ì´ì§€ì— ë³´ì—¬ì¤„ ê°ì²´ìˆ˜ë¥¼, `page`ëŠ” API ìš”ì²­ì´ ë“¤ì–´ì™”ì„ë•Œ ë³´ì—¬ì§ˆ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. 

**LectureServiceImpl.java**

~~~java
@Override
public Page<Lecture> getLecturesByPagination(Pageable pageable) {
   return lectureRepository.findAllByOrderByFirstCreatedDateDesc(pageable);
}
~~~

Repositoryì—ì„œ `findAllByOrderByFirstCreatedDateDesc()` ë©”ì†Œë“œë¥¼ ìƒì„±í•´ì„œ ì„œë¹„ìŠ¤ì—ì„œ í˜¸ì¶œí•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

**LectureRepository.java**

~~~java
@Repository
public interface LectureRepository extends JpaRepository<Lecture, Long> {
   Page<Lecture> findAllByOrderByFirstCreatedDateDesc(Pageable pageable);
~~~

ìœ„ì˜ Jpa ë©”ì†Œë“œë¥¼ í†µí•´ Hibernateê°€ ìƒì„±í•˜ëŠ” ì¿¼ë¦¬ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

~~~sql
SELECT * FROM Lecture Order By firstCreatedDate DESC LIMIT 5 OFFSET 40
~~~

![](src/main/resources/static/assets/documents/query-hibernate-created2.png)

<br>

## [ğŸ”](#toc)<a name="3">3. íŠ¸ëŸ¬ë¸” ìŠˆíŒ…</a>

### 3-1. Ajax ë™ê¸° í˜¸ì¶œ

[ë¡œê·¸ì¸ ê²€ì¦ ì½”ë“œ](https://github.com/youngjinmo/LecturePedia/blob/mysql/src/main/resources/templates/user/userLogin.html)

ë¡œê·¸ì¸ ê²€ì¦ì„ í•˜ëŠ” ê³¼ì •ì—ì„œ ìë°” ìŠ¤í¬ë¦½íŠ¸ í•¨ìˆ˜ë¥¼ 3ê°œë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. í•˜ë‚˜ëŠ” ì´ë©”ì¼ ê²€ì¦, í•˜ë‚˜ëŠ” ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ê·¸ë¦¬ê³  í•˜ë‚˜ëŠ” ì•ì„  ë‘ ê°œì˜ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ì˜€ìŠµë‹ˆë‹¤. ì´ë©”ì¼ í•¨ìˆ˜ê¹Œì§€ëŠ” ë¬¸ì œê°€ ì—†ì—ˆìœ¼ë‚˜ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê³¼ì •ì—ì„œ ì˜ë„ì™€ ë‹¤ë¥´ê²Œ API ê²°ê³¼ë¥¼ ì œëŒ€ë¡œ ê°€ì ¸ì˜¤ì§€ ëª»í•˜ëŠ” í˜„ìƒì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

ë¬¸ì œì˜ ì›ì¸ì€ Ajaxê°€ ê¸°ë³¸ì ìœ¼ë¡œ ë¹„ë™ê¸°ë¡œ ì‘ë™í•œë‹¤ëŠ” ì ì„ ì¸ì§€í•˜ì§€ ì•Šê³  ìŠ¤í¬ë¦½íŠ¸ í•¨ìˆ˜ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œí•œ ì œ ì˜ëª»ì´ì—ˆìŠµë‹ˆë‹¤. 

ë¡œê·¸ì¸ ê³¼ì •ì—ì„œì˜ ê²€ì¦ì€ ì•„ë˜ì˜ ìˆœì„œëŒ€ë¡œ ì§„í–‰ë˜ì–´ì•¼ í–ˆìŠµë‹ˆë‹¤.

1. ì´ë©”ì¼ ê²€ì¦
2. ì´ë©”ì¼ ê²€ì¦ì´ í†µê³¼ë˜ì—ˆë‹¤ë©´, í•´ë‹¹ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ APIí˜¸ì¶œí•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
3. ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ê¹Œì§€ í†µê³¼í–ˆë‹¤ë©´, submit í˜¸ì¶œ 

ë”°ë¼ì„œ ë¡œê·¸ì¸ ê²€ìˆ˜ì˜ ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ í•¨ìˆ˜ê°€ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œë ìˆ˜ ìˆë„ë¡ `async=false`ë¡œ ì§€ì •í•˜ì˜€ë”ë‹ˆ ì˜ë„í•œëŒ€ë¡œ ë¡œê·¸ì¸ ê²€ì¦ì„ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

<br>

### 3-2. RDBMS ë³€ê²½(H2->MySQL)

ì¸ë©”ëª¨ë¦¬ ê¸°ë°˜ì˜ h2ë°ì´í„° ë² ì´ìŠ¤ì—ì„œ ì˜ì†ì ìœ¼ë¡œ(persistence) ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” MySQLì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ RDBMSë¥¼ ë³€ê²½ì„ ì‹œë„í–ˆìŠµë‹ˆë‹¤. 

ë¨¼ì € ë„ì»¤ì—ì„œ MySQL ì´ë¯¸ì§€ë¥¼ ë‚´ë ¤ë°›ì•„ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤.

~~~bash
docker search mysql
docker pull mysql

docker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=password mysql
~~~

ê·¸ë¦¬ê³  ì»¨í…Œì´ë„ˆì— ì ‘ì†í•˜ì—¬, MySQLë¥¼ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤.

~~~bash
docker exec -it mysql bash
root@528e18f1f85b:/# mysql -uroot -p
~~~

ì´í›„ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ì‚¬ìš©ì ê³„ì •ì„ ìƒì„±í•˜ê³ , ë°ì´í„°ë² ì´ìŠ¤ì™€ í…Œì´ë¸”ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.

~~~sql
CREATE USER devandy@'%' identified by 'password';
CREATE DATABASE lecturepedia;
~~~

~~~sql
create table lecture (
   id bigint primary key auto_increment,
   first_created_date timestamp,
   last_modified_date timestamp,
   author_id bigint,
   author_name varchar(255),
   creator varchar(255) not null,
   description varchar(255) not null,
   lecture_url varchar(255) not null,
   title varchar(255) not null,
   views bigint
);

create table user (
   id bigint primary key auto_increment,
   first_created_date timestamp,
   last_modified_date timestamp,
   email varchar(255) not null,
   password varchar(255) not null,
   role varchar(255) not null,
   user_name varchar(255) not null
);
~~~

ì´ì œ MySQLê³¼ ê´€ë ¨í•œ Gradle ì˜ì¡´ì„±ì„ ì£¼ì…í–ˆìŠµë‹ˆë‹¤.

~~~groovy
implementation group: 'mysql', name: 'mysql-connector-java', version: '8.0.25'
implementation group: 'org.springframework.boot', name: 'spring-boot-starter-data-jdbc', version: '2.5.0'
~~~

 ê·¸ë¦¬ê³  application.propertiesë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. H2 ê´€ë ¨ ì†ì„±ì€ ëª¨ë‘ ì£¼ì„ì²˜ë¦¬í•˜ê³ , MySQL ê´€ë ¨ ì†ì„±ì„ ì¶”ê°€í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

~~~properties
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/lecturepedia
spring.datasource.username=devandy
spring.datasource.password=password
~~~

Dockerë¡œ MySQL ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ê³ , Debugë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ë‹ˆ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ë¥¼ ë§ˆì£¼í–ˆìŠµë‹ˆë‹¤.

![](src/main/resources/static/assets/documents/db-error.png)

`SQLException`ì´ ë°œìƒí–ˆê³ , ì—ëŸ¬ ë¡œê·¸ë¥¼ ë³´ë‹ˆ `Access denied for user 'devandy@172.17.0.1'` ì´ ë¡œê·¸ì— ì°íŒê±¸ë¡œ ë³´ì•„ devandyë¼ëŠ” DB ì‚¬ìš©ì ê³„ì •ì— ì ‘ê·¼í• ë•Œ ë¬¸ì œê°€ ë°œìƒí–ˆìŒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ìŠ¤íƒì˜¤ë²„í”Œë¡œìš°ë¥¼ í†µí•´ì„œ ì´ëŸ° ê²½ìš°, DB ì‚¬ìš©ìê³„ì •ì— ëŒ€í•œ privilegesë¡œì¸í•œ ë¬¸ì œì¼ ìˆ˜ ìˆë‹¤ê³  í•˜ì—¬ MySQL ì»¨í…Œì´ë„ˆì— ì ‘ì†í•˜ì˜€ìŠµë‹ˆë‹¤.

Privilegesë¥¼ ìˆ˜ì •í•˜ê¸° ìœ„í•´ ì‹œë„í•˜ì˜€ìœ¼ë‚˜ í•´ë‹¹ ì‚¬ìš©ìê°€ í…Œì´ë¸”ì— ì¡´ì¬í•˜ì§€ ì•Šì•„ì„œ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì‚¬ìš©ìë¥¼ ë‹¤ì‹œ ìƒì„±í•˜ë ¤ê³  í•˜ì˜€ìœ¼ë‚˜ ì´ë²ˆì—” ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ ë¡œê·¸ê°€ ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. 

~~~
ERROR 1396 (HY000): Operation CREATE USER failed for 'devandy'@'localhost'
~~~

ì‚¬ìš©ì ëª©ë¡ì—ì„œëŠ” ë³´ì´ì§€ ì•Šì•˜ìœ¼ë‚˜ ì´ëŸ°ì €ëŸ° í…ŒìŠ¤íŠ¸í•˜ëŠ” ê³¼ì •ì—ì„œ DBì— í•œ ë²ˆ ìƒì„±ëœì ì´ ìˆëŠ” `devandy` ë¼ëŠ” ê³„ì •ì´ ì™„ì „íˆ ì‚­ì œëœê²ƒ ê°™ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì•„ë˜ì˜ ëª…ë ¹ì–´ë¡œ ì™„ì „íˆ ì‚­ì œì´í›„ì— ë‹¤ì‹œ ìƒì„±í–ˆìŠµë‹ˆë‹¤.

~~~sql
DROP USER 'devandy'@'localhost'
flush privileges;
CREATE USER 'devandy'@'localhost' IDENTIFIED BY 'password';
~~~

ì¿¼ë¦¬ê°€ OK ë˜ì—ˆìŒì„ í™•ì¸í•˜ê³ , ì´ì œ ê¶Œí•œì„ ë¶€ì—¬í•˜ì˜€ìŠµë‹ˆë‹¤.

~~~sql
GRANT ALL privileges on lecturepedia.* to devandy@'localhost';
~~~

ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ '%'ë„ ëª¨ë“  ê¶Œí•œì„ ë¶€ì—¬í–ˆìŠµë‹ˆë‹¤.

~~~sql
CREATE USER devandy@'%' identified by 'password';
GRANT ALL privileges on lecturepedia.* to devandy@'%';
~~~

ë‹¤ì‹œ Debugë¡œ ì‹¤í–‰í•˜ë‹ˆ ì´ë²ˆì—” SEQUENCE ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê²€ìƒ‰ì„ í•´ë³´ë‹ˆ JPA ê´€ë ¨ ì—ëŸ¬ì˜€ëŠ”ë°, application.propertiesì—ì„œ JPAí”Œë«í¼ì„ MySQLë¡œ í•˜ì§€ì•Šì•„ì„œ ë°œìƒí•œ ë¬¸ì œì˜€ìŠµë‹ˆë‹¤.

![](src/main/resources/static/assets/documents/db-error2.png)

~~~properties
# spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.database-platform=org.hibernate.dialect.MySQL5InnoDBDialect
~~~

ì´ë ‡ê²Œê¹Œì§€ ìˆ˜ì •í•˜ê³  ë‹¤ì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ë©´ ì œëŒ€ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.

<br>

## [ğŸ”](#toc)<a name="4">4. í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë°°ìš´ ê²ƒ</a>

### 4-1. ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì—ì„œì˜ DIP

OOPë¥¼ ìœ„í•´ì„œ ì˜ì¡´ì„±ì„ ì™¸ë¶€ì—ì„œ ì£¼ì…í•˜ëŠ” í˜•íƒœë¡œ ìë°” í”„ë¡œê·¸ë˜ë°ì„ í–ˆëŠ”ë°, ìŠ¤í”„ë§ë¶€íŠ¸ í”„ë¡œì íŠ¸ì—ì„  `@Autowired` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ DIë¥¼ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì˜ì¡´ì„±ì´ ì¶”ê°€ë ë•Œë§ˆë‹¤ ê°œë°œìê°€ ì§ì ‘ ìƒì„±ìì— íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€í•  í•„ìš”ì—†ì´, ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ ì‰½ê²Œ ì˜ì¡´ì„±ì„ ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ë„ë¡ ì„¤ê³„í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

`@Autowired`ë¥¼ í•  ìˆ˜ ìˆëŠ” ëŒ€ìƒì€ ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì—ì„œ ê´€ë¦¬í•˜ëŠ” Beanìœ¼ë¡œ í•œì •ë˜ëŠ”ë°, ì´ ë•Œë„ ì—­ì‹œ ì–´ë…¸í…Œì´ì…˜(`@Controller`, `@Service`, `@Component`)ì„ í†µí•´ ì‰½ê²Œ Beanì„ ë“±ë¡í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 

MVC íŒ¨í„´ì— ë¬´ê´€í•œ ê°ì²´ëŠ” ê°œë°œìê°€ ë”°ë¡œ ë¹ˆìœ¼ë¡œ ì£¼ì…í•´ì•¼ í•˜ëŠ”ë°, ì´ë•Œ `@Component`ëŠ” í´ë˜ìŠ¤ë¥¼, `@Bean`ì€ ë©”ì†Œë“œë¥¼ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ”ê²ƒë„ í•™ìŠµí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

### 4-2. JPA ì¥ì 

JPAë¥¼ ì²˜ìŒ ì‚¬ìš©í•´ë³´ì•˜ëŠ”ë°, ê°œë°œìê°€ ì¼ì¼íˆ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  í•„ìš”ì—†ì´ JpaRepositoryë¥¼ ìƒì†ë°›ëŠ” Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±í•´ì„œ ë©”ì†Œë“œ ì´ë¦„ë§Œìœ¼ë¡œ ì¿¼ë¦¬ê°€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ì¼ì´ ë§¤ìš° í¥ë¯¸ë¡œì› ìŠµë‹ˆë‹¤. 

ì²˜ìŒì—” JPAê°€ ìµìˆ™ì¹˜ ì•Šë‹¤ë³´ë‹ˆ ì•„ë˜ì²˜ëŸ¼ JPQLì„ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì„œ ì´ìš©ë„ í•´ë³´ì•˜ì§€ë§Œ, JPAë¥¼ ì‚¬ìš©í•˜ë‹ˆ SQL ì˜¤íƒ€ì— ëŒ€í•œ ì—ëŸ¬ë¥¼ ê±±ì •í•˜ì§€ ì•Šì•„ë„ ë˜ë‹ˆ ë” í¸ë¦¬í•˜ë‹¤ëŠ” ëŠë‚Œì„ ë°›ì•˜ìŠµë‹ˆë‹¤.

~~~java
@Autowired
private EntityManager entityManeger;
...
@Override
public List<Lecture> getLectureMostView(int count) {
   String query = "SELECT lecture FROM Lecture ORDER BY lecture.views DESC";
   TypedQuery typedQuery = entityManager.createQuery(query, Lecture.class);
   typedQuery.setMaxResults(count);
   return typedQuery.getResultList();
}
~~~

<br>
